<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS ì§„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: sans-serif;
            padding: 20px;
        }

        button {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.2rem;
            border: 2px solid #444;
            border-radius: 12px;
            background: #222;
            color: #fff;
            cursor: pointer;
        }

        button:active {
            background: #444;
        }

        .success {
            border-color: #4bff4b;
        }

        .info {
            border-color: #4b9fff;
        }

        #log {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        h2 {
            color: #ff6b6b;
        }
    </style>
</head>

<body>
    <h2>ğŸ”Š TTS ì§„ë‹¨ í…ŒìŠ¤íŠ¸</h2>
    <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”. ì†Œë¦¬ê°€ ë‚˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <button onclick="testBasic('en')" class="success">í…ŒìŠ¤íŠ¸ 1: ì˜ì–´ (Hello World)</button>
    <button onclick="testBasic('ja')" class="success">í…ŒìŠ¤íŠ¸ 2: ì¼ë³¸ì–´ (ã“ã‚“ã«ã¡ã¯)</button>
    <button onclick="testBasic('ko')" class="success">í…ŒìŠ¤íŠ¸ 3: í•œêµ­ì–´ (ì•ˆë…•í•˜ì„¸ìš”)</button>
    <button onclick="testWithLang()" class="info">í…ŒìŠ¤íŠ¸ 4: lang='en-US' ì§€ì •</button>
    <button onclick="testNoLang()" class="info">í…ŒìŠ¤íŠ¸ 5: lang ì—†ì´ ì˜ì–´</button>
    <button onclick="testWithVoice()" class="info">í…ŒìŠ¤íŠ¸ 6: ì˜ì–´ Voice ì§€ì •</button>
    <button onclick="showVoices()" style="border-color: #ffb74b;">ìŒì„± ëª©ë¡ ë³´ê¸°</button>

    <div id="log">ê²°ê³¼ê°€ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤...\n</div>

    <script>
        const logEl = document.getElementById('log');
        function log(msg) {
            logEl.textContent += msg + '\n';
            logEl.scrollTop = logEl.scrollHeight;
        }

        function testBasic(lang) {
            log(`\n--- í…ŒìŠ¤íŠ¸: ${lang} ---`);
            try {
                const synth = window.speechSynthesis;
                if (!synth) { log('âŒ speechSynthesis ì—†ìŒ!'); return; }

                synth.cancel();

                const texts = { en: 'Hello World', ja: 'ã“ã‚“ã«ã¡ã¯', ko: 'ì•ˆë…•í•˜ì„¸ìš”' };
                const langs = { en: 'en-US', ja: 'ja-JP', ko: 'ko-KR' };

                const u = new SpeechSynthesisUtterance(texts[lang]);
                u.lang = langs[lang];
                u.rate = 1.0;

                u.onstart = () => log(`âœ… ${lang} ì‹œì‘ë¨!`);
                u.onend = () => log(`âœ… ${lang} ì™„ë£Œ!`);
                u.onerror = (e) => log(`âŒ ${lang} ì—ëŸ¬: ${e.error}`);

                log(`speaking: "${texts[lang]}" (lang=${langs[lang]})`);
                synth.speak(u);
                log(`speak() í˜¸ì¶œë¨. pending=${synth.pending}, speaking=${synth.speaking}`);
            } catch (e) {
                log(`âŒ ì˜ˆì™¸: ${e.message}`);
            }
        }

        function testWithLang() {
            log('\n--- í…ŒìŠ¤íŠ¸ 4: lang=en-US ì§€ì • ---');
            const synth = window.speechSynthesis;
            synth.cancel();
            const u = new SpeechSynthesisUtterance('apple banana cherry');
            u.lang = 'en-US';
            u.onstart = () => log('âœ… ì‹œì‘!');
            u.onend = () => log('âœ… ì™„ë£Œ!');
            u.onerror = (e) => log('âŒ ì—ëŸ¬: ' + e.error);
            synth.speak(u);
            log('speak() called');
        }

        function testNoLang() {
            log('\n--- í…ŒìŠ¤íŠ¸ 5: lang ì—†ì´ ì˜ì–´ ---');
            const synth = window.speechSynthesis;
            synth.cancel();
            const u = new SpeechSynthesisUtterance('apple banana cherry');
            // langì„ ì„¤ì •í•˜ì§€ ì•ŠìŒ
            u.onstart = () => log('âœ… ì‹œì‘!');
            u.onend = () => log('âœ… ì™„ë£Œ!');
            u.onerror = (e) => log('âŒ ì—ëŸ¬: ' + e.error);
            synth.speak(u);
            log('speak() called (no lang set)');
        }

        function testWithVoice() {
            log('\n--- í…ŒìŠ¤íŠ¸ 6: voice ì§€ì • ---');
            const synth = window.speechSynthesis;
            synth.cancel();
            const voices = synth.getVoices();
            log(`ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„±: ${voices.length}ê°œ`);

            const enVoice = voices.find(v => v.lang.includes('en'));
            if (enVoice) {
                log(`ì˜ì–´ ìŒì„± ë°œê²¬: ${enVoice.name} (${enVoice.lang})`);
                const u = new SpeechSynthesisUtterance('apple banana cherry');
                u.voice = enVoice;
                u.lang = enVoice.lang;
                u.onstart = () => log('âœ… ì‹œì‘!');
                u.onend = () => log('âœ… ì™„ë£Œ!');
                u.onerror = (e) => log('âŒ ì—ëŸ¬: ' + e.error);
                synth.speak(u);
            } else {
                log('âŒ ì˜ì–´ ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
                // lang=en-USë¡œë§Œ ì‹œë„
                const u = new SpeechSynthesisUtterance('apple banana cherry');
                u.lang = 'en-US';
                u.onstart = () => log('âœ… fallback ì‹œì‘!');
                u.onend = () => log('âœ… fallback ì™„ë£Œ!');
                u.onerror = (e) => log('âŒ fallback ì—ëŸ¬: ' + e.error);
                synth.speak(u);
            }
        }

        function showVoices() {
            log('\n--- ìŒì„± ëª©ë¡ ---');
            const voices = window.speechSynthesis.getVoices();
            log(`ì´ ${voices.length}ê°œ ìŒì„±:`);
            voices.forEach((v, i) => {
                log(`  ${i}: ${v.name} | ${v.lang} | ${v.localService ? 'local' : 'network'}`);
            });
            if (voices.length === 0) {
                log('âš ï¸ ìŒì„±ì´ 0ê°œì…ë‹ˆë‹¤!');
                log('voiceschanged ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤...');
                speechSynthesis.onvoiceschanged = () => {
                    const v2 = speechSynthesis.getVoices();
                    log(`voiceschanged í›„: ${v2.length}ê°œ`);
                    v2.forEach((v, i) => {
                        log(`  ${i}: ${v.name} | ${v.lang} | ${v.localService ? 'local' : 'network'}`);
                    });
                };
            }
        }

        // ìë™ìœ¼ë¡œ ìŒì„± ëª©ë¡ ë¡œë“œ ì‹œë„
        log('speechSynthesis ì§€ì›: ' + (!!window.speechSynthesis));
        if (window.speechSynthesis) {
            const v = window.speechSynthesis.getVoices();
            log('ì´ˆê¸° ìŒì„± ìˆ˜: ' + v.length);
        }
    </script>
</body>

</html>